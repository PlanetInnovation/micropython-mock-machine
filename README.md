# mock_machine

A MicroPython library designed to mock machine module for use in unit tests

Allow testing of of drivers without relying on actual hardware, by providing a mock of `machine`
module; the mock classes can be configured to respond in a predictable way.

Currently mock_machine implements:

- `I2C`
    - `init`
    - `deinit`
    - `scan`
    - `readfrom`
    - `readfrom_into`
    - `writeto`
    - `readfrom_mem`
    - `readfrom_mem_into`
    - `writeto_mem`
- `SPI`
    - `__init__`
    - `read`
`- Pin`
    - `__init__`
    - `init`
    - `value`
    - `on`
    - `off`
    - `irq`
    - `mode`
    - `__call__`
- `ADC`
    - `__init__`
    - `read_u16`

The following additional functionality has been implemented to allow for mocking of multiple devices
connected to communications bus:

- `I2C.add_device`
  The ability to add an `I2CDevice` to an `I2C` bus.
- `I2CDevice`
  A class for defining a single device connected to an `I2C` bus, automatically uses
  `I2C.add-device` to add itself to provided `I2C` bus on creation.

In `examples/` there are drivers that are unit tested using `I2C`, `SPI`, and `Pin`

This project has been generated by using the [micropython_module_template](https://gitlab.pi.planetinnovation.com.au/degraves/micropython_module_template). If the template is updated it can be re-applied:

```
> copier update
```


## Next steps

* Create a repository from this template

```bash
# cd to where the templates were generated
> git init
> git symbolic-ref HEAD refs/heads/main # Optional: default is master, change to main
> git add --all
# Create an empty repo in Gitlab using the web interface
> git remote add origin git@gitlab.pi.planetinnovation.com.au:[yourID]/mock-machine.git
> pre-commit install
> git commit -m "Commit message"
> git push -u origin main
```
* Add your code and your tests
* ...


## Output structure

```bash
ğŸ“ example_output
â”œâ”€â”€ ğŸ“„ mock_machine.py ----------------- # Your library file
â”œâ”€â”€ ğŸ“ doc ----------------------------- # Documentation for this library
â”œâ”€â”€ ğŸ“ test ---------------------------- # Unit test code
â”‚   â””â”€â”€ ğŸ“„ test_mock_machine.py -------- # Unit test example
â”œâ”€â”€ ğŸ“ lib ----------------------------- # Dependencies (typically required to run examples or run tests)
â”œâ”€â”€ ğŸ“ examples ------------------------ # Examples of use of this library
â”œâ”€â”€ ğŸ“„ .gitignore ---------------------- # A standard .gitignore file
â”œâ”€â”€ ğŸ“„ .gitlab-ci.yml ------------------ # Continuous Integration configuration for Gitlab
â”œâ”€â”€ ğŸ“„ .copier-answers.yml ------------- # Answers are recorded here
â””â”€â”€ ğŸ“„ pylintrc ------------------------ # PyLint configuration
```
